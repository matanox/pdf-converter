// Generated by CoffeeScript 1.6.3
var docsDataDir, files, logging, myWriter, util;

myWriter = require('./writer');

logging = require('../util/logging');

util = require('../util/util');

docsDataDir = 'docData';

exports.docsDataDir = docsDataDir;

files = {};

exports.write = function(inputFileName, dataType, data, cnsl) {
  var nameBase, now, writer;
  if (files[inputFileName] == null) {
    files[inputFileName] = {};
    console.log("data directory link: file://" + (process.cwd()) + "/" + docsDataDir + "/" + inputFileName);
  }
  if (files[inputFileName][dataType] == null) {
    logging.cond("opening writer for " + dataType, 'dataWriter');
    util.mkdir(docsDataDir, inputFileName);
    now = new Date();
    nameBase = docsDataDir + '/' + inputFileName + '/' + dataType + '-' + now.toISOString() + '.out';
    writer = new myWriter(nameBase);
    logging.cond("Data writing for [" + inputFileName + "], [" + dataType + "] is going to " + nameBase, 'dataWriter');
    files[inputFileName][dataType] = writer;
  }
  files[inputFileName][dataType].write(data);
  if (cnsl != null) {
    logging.logBlue(data);
  }
  return true;
};

exports.close = function(inputFileName) {
  var writer;
  logging.cond("closing writers for " + inputFileName, 'dataWriter');
  for (writer in files[inputFileName]) {
    logging.cond("writer to close: " + writer, logging.cond);
    files[inputFileName][writer].close();
  }
  return delete files[inputFileName];
};

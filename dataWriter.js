// Generated by CoffeeScript 1.6.3
var fs, logging, winston, winstonWrite, writers;

logging = require('./logging');

winston = require('winston');

fs = require('fs');

writers = {};

winstonWrite = function(writer, data) {
  return writer.info(data);
};

exports.write = function(inputFileName, dataType, data) {
  var err, nameBase, now, writer, writerName;
  writerName = inputFileName + dataType;
  if (writers[writerName] == null) {
    writer = new winston.Logger;
    now = new Date();
    try {
      fs.mkdirSync('docData/' + inputFileName);
    } catch (_error) {
      err = _error;
      if (err.code !== 'EEXIST') {
        throw e;
      }
    }
    nameBase = 'docData/' + inputFileName + '/' + dataType + '-' + now.toISOString() + '.out';
    writer = new winston.Logger({
      transports: [
        new winston.transports.File({
          name: 'file#json',
          filename: nameBase + '.json',
          json: true,
          timestamp: false
        }), new winston.transports.File({
          name: 'file#text',
          filename: nameBase,
          json: false,
          timestamp: false
        })
      ],
      exitOnError: false
    });
    logging.cond("Data writing for [" + inputFileName + "], [" + dataType + "] is going to " + nameBase, 'dataWriter');
    writers[writerName] = writer;
  }
  winstonWrite(writers[writerName], data);
  return true;
};
